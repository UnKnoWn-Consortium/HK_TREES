<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hong Kong Tree Database</title>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-title" content="Hong Kong Tree Database">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!-- <link rel="icon" type="image/png" sizes="192x192"  href="">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="img/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon/favicon-16x16.png">
    <link rel="icon" type="image/x-icon" sizes="16x16" href="img/favicon/favicon.ico"> -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700|Poiret+One|Graduate' rel="stylesheet" type="text/css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"  type="text/css">
    <link href="style/main.css" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular-sanitize.js"></script>
    <script src="script/vendor/ui-bootstrap-tpls-0.13.3.min.js"></script>
</head>
<body data-ng-app="main">
    <header>
        <main>
            <h1>Hong Kong</h1>
            <img class="img-circle" alt="100x100" src="img/tree_logo.png">
            <h1>Tree Database</h1>
        </main>
        <aside class="btn-group">
            <button type="button" class="btn btn-default active"><img class="btn-icon" alt="list" src="img/list.svg">List</button>
            <button type="button" class="btn btn-default"><img class="btn-icon" alt="map" src="img/map.svg">Map</button>
            <button type="button" class="btn btn-default"><img class="btn-icon" alt="stat" src="img/stat.svg">Stat</button>
        </aside>
        <aside class="btn-group" id="user-svc" dropdown keyboard-nav>
            <button id="user" type="button" class="btn btn-info">
                <img class="img-rounded avatar" alt="50x50" src="data/users/avatars/avatar.svg">
                <div id="username">Username</div>
            </button>
            <button type="button" class="btn btn-info dropdown-toggle" style="height: 49px" dropdown-toggle>
                <span class="caret"></span>
                <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="user">
                <li><a href="#"><span class="glyphicon glyphicon-user"></span> User</a></li>
                <li><a href="#"><span class="glyphicon glyphicon-cog"></span> Settings</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
            </ul>
        </aside>
    </header>
    <main id="list-space" data-ng-controller="cardSpaceCtrl as parentCtrl" data-ng-init="parentCtrl.loadTrees()">

        <article data-ng-class="tree.district | distClassFilter" data-ng-repeat="tree in parentCtrl.trees" data-ng-controller="cardCtrl as ctrl">
            <section class="photo-container" data-ng-class="{'flip': ctrl.backFace}">
                <div class="photo">
                    <div class="front face" data-ng-click="ctrl.toggleBackFace()">
                        <img data-ng-repeat="photo in tree.photos" alt="tree photo {{$index}}" data-ng-src="data/tree_photos/{{photo.path}}" data-ng-class="{removed: tree.removed}">
                    </div>
                    <div class="back face">
                        <img src="img/back.svg" alt="Back" id="back" data-ng-click="ctrl.toggleBackFace()">
                        <section id="notice">
                            <h2 data-ng-show="ctrl.currentPage == 1">Notice</h2>
                            <div class="special-notice" data-ng-if="tree.removed" data-ng-show="ctrl.currentPage == 1">
                                <h3>Removed on </h3>
                                <h3>{{tree.removed_date | date:"d'th' MMMM yyyy"}}</h3>
                                <h4>due to</h4>
                                <h3 data-ng-repeat="reason in tree.removed_reasons" data-ng-bind="reason"></h3>
                            </div>
                        </section>
                        <section id="information">
                            <h2 data-ng-show="ctrl.currentPage == 2">Information</h2>
                            <div class="species plate" data-ng-show="ctrl.currentPage == 2">
                                <div class="part head owner">
                                    <h1 data-tooltip-placement="top" data-tooltip="Government Owned">GOV</h1>
                                    <div class="icon">
                                        <img data-ng-if="tree.stone_wall_tree" alt="Stone Wall Tree" src="img/stone-wall-tree.svg" class="icon"  data-tooltip-placement="bottom" data-tooltip="Stone Wall Tree">
                                    </div>
                                </div>
                                <div class="part species">
                                    <h1 data-ng-bind="tree.species"></h1>
                                </div>
                            </div>
                        </section>
                        <section id="location">
                            <h2 data-ng-show="ctrl.currentPage == 3">Location</h2>
                            <div class="register plate" data-ng-show="ctrl.currentPage == 3">
                                <div class="part head department" data-tooltip-placement="bottom" data-tooltip="Highways Department">
                                    <h1>HYD</h1>
                                    <div>
                                        <img alt="Highways Department" src="img/govt_dept/hyd.png" class="icon">
                                    </div>
                                </div>
                                <div class="part number">
                                    <h1 data-ng-bind="tree.register_no"></h1>
                                </div>
                            </div>
                            <div class="location-details plate" data-ng-show="ctrl.currentPage == 3">
                                <div class="part head simar" data-ng-if="!!tree.location_details.simar" data-tooltip-placement="right" data-tooltip="Systematic Identification of Maintenance Responsibility of Slopes">
                                    <h1>SIM<br>AR</h1>
                                </div>
                                <div class="part simar_no" data-ng-if="!!tree.location_details.simar">
                                    <h1 data-ng-bind="tree.location_details.simar_no"></h1>
                                </div>
                            </div>
                            <div class="coordinate plate">
                                <div class="part coord" data-ng-if="!!tree.location_details.coordinate">
                                    <div class="cor-x">

                                    </div>
                                    <div class="cor-y">

                                    </div>
                                </div>
                                <div class="part" data-ng-if="!!tree.location_details.simar">

                                </div>
                            </div>
                        </section>
                        <section id="pagination">
                            <pagination data-direction-links="false" data-total-items="3" data-items-per-page="1" data-ng-model="ctrl.currentPage"></pagination>
                        </section>

                        <!--<button class="btn btn-primary btn-block">Read Previous Records</button>-->
                    </div>
                </div>
            </section>

            <section class="location">
                <h3 data-ng-bind="tree.location"></h3>
                <h3 data-ng-bind="tree.district | districtFilter"></h3>
            </section>
        </article>


    </main>
    <script>
        var app = angular.module('main', ['ui.bootstrap']);
        app.controller('cardSpaceCtrl', ['FBUserSvc', 'dataSvc', function(FBUserSvc, dataSvc){
            var self = this;
            this.trees = [];
            this.loadTrees = function(){
                dataSvc.getData(0).then(function(res){
                    console.log(res);
                    self.trees = self.trees.concat(res.data.payload);
                });
            };
        }]).controller('cardCtrl', ['govtSMRISDataSvc', function(govtSMRISDataSvc){
            this.currentPage = 1;
            this.backFace = false;
            this.toggleBackFace = function(){
                this.backFace = !this.backFace;
            };
        }]);

        app.factory('FBUserSvc', ['$http', function($http){
            var user = {
                userID: "",
                pwHash: ""
            };
            return {

            };
        }]).factory('dataSvc', ['$http', '$q', '$timeout', function($http, $q, $timeout){
            return {
                getData: function(offset){
                    // mock
                    var data = [{ // Reference object database schema (removed=false)
                        district: "cw",
                        location: "Arbuthnot Road",
                        location_details: {
                            simar: true,
                            simar_no: "11sw-b/r74",
                            coordinate: {
                                x: 123,
                                y: 123
                            }
                        },
                        govt: true,
                        dept: "hyd",
                        removed: false,
                        stone_wall_tree: true,
                        species: "Ficus Microcarpa",
                        register_no: "CW/002",
                        dept_no: "hyd_hk_11sw_b_r74_0_wt2",
                        photos: [{path: "hyd_hk_11sw_b_r74_0_wt2.jpg"}]
                    }, { // Reference object database schema (removed=true)
                        district: "cw",
                        location: "Arbuthnot Road",
                        location_details: {
                            simar: true,
                            simar_no: "11sw-b/r74",
                            coordinate: {
                                x: 123,
                                y: 123
                            }
                        },
                        govt: true,
                        dept: "hyd",
                        removed: true,
                        removed_date: "2015-06-05T12:00:00.000Z",
                        removed_reasons: ["Trunk Failure"],
                        stone_wall_tree: true,
                        species: "Ficus Virens Var. Sublanceolata",
                        register_no: "CW/003",
                        dept_no: "hyd_hk_11sw_b_r74_0_wt3",
                        photos: [{path: "hyd_hk_11sw_b_r74_0_wt3.jpg"}]
                    }, {
                        district: "cw",
                        location: "Arbuthnot Road",
                        location_details: {
                            simar: true,
                            simar_no: "11sw-b/r74",
                            coordinate: {
                                x: 123,
                                y: 123
                            }
                        },
                        govt: true,
                        dept: "hyd",
                        removed: false,
                        stone_wall_tree: false,
                        species: "Ficus Virens Var. Sublanceolata",
                        register_no: "CW/004",
                        dept_no: "hyd_hk_11sw_b_r74_0_wt4",
                        photos: [{path: "hyd_hk_11sw_b_r74_0_wt4.jpg"}]
                    }, {
                        district: "cw",
                        location: "Borrett Road",
                        location_details: {
                            simar: true,
                            simar_no: "11sw-b/r530",
                            coordinate: {
                                x: 123,
                                y: 123
                            }
                        },
                        govt: true,
                        dept: "hyd",
                        removed: false,
                        stone_wall_tree: true,
                        species: "Ficus Microcarpa",
                        register_no: "CW/007",
                        dept_no: "hyd_hk_11sw_b_r530_0_wt1",
                        photos: [{path: "hyd_hk_11sw_b_r530_0_wt1.jpg"}]
                    }, {
                        district: "cw",
                        location: "Bowen Road",
                        location_details: {
                            simar: true,
                            simar_no: "11sw-b/fr124",
                            coordinate: {
                                x: 123,
                                y: 123
                            }
                        },
                        govt: true,
                        dept: "hyd",
                        removed: false,
                        stone_wall_tree: false,
                        species: "Ficus Virens Var. Sublanceolata",
                        register_no: "CW/008",
                        dept_no: "hyd_hk_11sw_b_fr124_0_wt1",
                        photos: [{path: "hyd_hk_11sw_b_fr124_0_wt1.jpg"}]
                    }];
                    return $q(function(resolve, reject){
                        $timeout(1000).then(function(){
                            resolve({data: {payload: data.slice(offset)}});
                        });
                    });
                    // ----

                    /* API Service
                    return $http.get('api/trees', {params: {'offset': offset}});
                    */
                }
            };
        }]).factory('govtSMRISDataSvc', ['$http', function($http){
            return {
                getSlope: function(sn){
                    return $http.get('http://www2.slope.landsd.gov.hk/smris/getSlopeBySlopeNo', {params: {'sn': sn}});
                },
                getSlopeTechInfo: function(sn){
                    return $http.get('http://www2.slope.landsd.gov.hk/smris/getSlopeTechInfo', {params: {'sn': sn}});
                }
            }
        }]);

        app.filter('districtFilter', [function(){
            var dist_table = {
                 cw: 'Central and Western',
                  e: 'Eastern',
                  s: 'Southern',
                 wc: 'Wan Chai',
                 kc: 'Kowloon City',
                ktn: 'Kwun Tong',
                ssp: 'Sham Shui Po',
                wts: 'Wong Tai Sin',
                ytm: 'Yau Tsim Mong',
                 is: 'Island',
                kts: 'Kwai Tsing',
                  n: 'North',
                 sk: 'Sai Kung',
                 st: 'Sha Tin',
                 tp: 'Tai Po',
                 tw: 'Tsuen Wan',
                 tm: 'Tuen Mun',
                 yl: 'Yuen Long'
            };
            return function(input){
                return dist_table[input];
            };
        }]).filter('areaFilter', [function(){
            var area_table = {
                 cw: 'Hong Kong',
                  e: 'Hong Kong',
                  s: 'Hong Kong',
                 wc: 'Hong Kong',
                 kc: 'Kowloon',
                ktn: 'Kowloon',
                ssp: 'Kowloon',
                wts: 'Kowloon',
                ytm: 'Kowloon',
                 is: 'New Territories',
                kts: 'New Territories',
                  n: 'New Territories',
                 sk: 'New Territories',
                 st: 'New Territories',
                 tp: 'New Territories',
                 tw: 'New Territories',
                 tm: 'New Territories',
                 yl: 'New Territories'
            };
            return function(input){
                return area_table[input];
            };
        }]).filter('distClassFilter', [function(){
            var dist_table = {
                 cw: 'central-and-western',
                  e: 'eastern',
                  s: 'southern',
                 wc: 'wan-chai',
                 kc: 'kowloon-city',
                ktn: 'Kwun-tong',
                ssp: 'sham-shui-po',
                wts: 'wong-tai-sin',
                ytm: 'yau-tsim-mong',
                 is: 'island',
                kts: 'kwai-tsing',
                  n: 'north',
                 sk: 'sai-kung',
                 st: 'sha-tin',
                 tp: 'tai-po',
                 tw: 'tsuen-wan',
                 tm: 'tuen-mun',
                 yl: 'yuen-long'
            };
            return function(input){
                var temp = {};
                temp[dist_table[input]] = true;
                return temp;
            }
        }]);
    </script>
</body>
</html>